<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ©Ÿæ™ºçš„é–€å¾’ç”Ÿæ´» | å­¸éœ¸é¤Šæˆç­</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="../assets/js/common.js"></script>
</head>
<body class="pb-20">
    <nav class="nature-nav sticky top-0 z-50">
        <div class="container mx-auto px-6 max-w-5xl">
            <div class="flex flex-col md:flex-row justify-between items-center py-3">
                 <div class="flex items-center gap-3 mb-4 md:mb-0 group cursor-pointer" onclick="window.location.href='../index.html'">
                    <div class="w-10 h-10 bg-[#6B8E23] rounded-full flex items-center justify-center text-white shadow-md">
                        <i data-lucide="map" class="w-5 h-5"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-lg font-serif font-bold text-[#3E3B39]">æ©Ÿæ™ºçš„é–€å¾’ç”Ÿæ´»</span>
                    </div>
                </div>
                <div class="flex flex-wrap justify-center gap-1">
                    <a href="../index.html" class="nav-item font-bold text-[#6B8E23]">
                        <i data-lucide="home" class="w-4 h-4"></i> å›é¦–é 
                    </a>
                    <div class="w-px h-6 bg-gray-300 mx-2 self-center"></div>
                    <a href="../daily/index.html" class="nav-item">é€šè­˜ä¸­å¿ƒ</a>
                    <a href="../library/index.html" class="nav-item">åœ–æ›¸é¤¨</a>
                    <a href="../chaplain/index.html" class="nav-item">æ ¡ç‰§å®¤</a>
                    <a href="index.html" class="nav-item active">å­¸éœ¸é¤Šæˆç­</a>
                    <a href="../games/index.html" class="nav-item">èª²å¤–æ´»å‹•</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="relative z-10 container mx-auto px-4 py-8 max-w-4xl">
        <section id="section-school" class="page-section fade-in">
            <!-- é¸å–®å€ -->
            <div id="school-menu">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-serif text-[#3E3B39]">å­¸éœ¸é¤Šæˆç­</h2>
                    <p class="eng-script text-[#8D7B68]">Bible Study & Trivia</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="menu-grid">
                    <!-- JS ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æ¸¬é©—é€²è¡Œå€ -->
            <div id="school-quiz-area" class="hidden"></div>
        </section>
    </div>

    <script>
        const QUIZ_CONFIG = [
            {
                id: 'exam',
                title: 'è–ç¶“å¤§æœƒè€ƒ',
                subtitle: 'é™æ™‚æŒ‘æˆ° (3åˆ†é˜)',
                icon: 'timer',
                type: 'exam',
                url: 'https://raw.githubusercontent.com/annelin0321/witty-bible-data/main/bible-quiz.json',
                desc: 'æ¸¬é©—ä½ çš„è–ç¶“ç¶œåˆèƒ½åŠ›ï¼Œæ™‚é–“åˆ°æ‰ç®—åˆ†å–”ï¼'
            },
            {
                id: 'messiah',
                title: 'é‡è¦‹å½Œè³½äº',
                subtitle: 'è€¶ç©Œç”Ÿå¹³',
                icon: 'cross',
                type: 'practice',
                url: 'https://raw.githubusercontent.com/annelin0321/witty-bible-data/main/life-of-jesus.json',
                desc: 'æ·±å…¥äº†è§£è€¶ç©Œçš„ç”Ÿå¹³èˆ‡æ•™å°ã€‚'
            },
            {
                id: 'characters',
                title: 'è–ç¶“äººç‰©',
                subtitle: 'äººç‰©èªŒ',
                icon: 'users',
                type: 'practice',
                url: 'https://raw.githubusercontent.com/annelin0321/witty-bible-data/main/bible-characters.json',
                desc: 'çŒœçŒœä»–æ˜¯èª°ï¼Ÿèªè­˜è–ç¶“ä¸­çš„é—œéµäººç‰©ã€‚'
            },
            {
                id: 'geography',
                title: 'è–ç¶“åœ°ç†',
                subtitle: 'åœ°åœ–å°è¦½',
                icon: 'map',
                type: 'practice',
                url: 'https://raw.githubusercontent.com/annelin0321/witty-bible-data/main/bible-geography.json',
                desc: 'è·Ÿè‘—è–ç¶“å»æ—…è¡Œï¼Œæ¢ç´¢æ‡‰è¨±ä¹‹åœ°ã€‚'
            },
            {
                id: 'trivia',
                title: 'è–ç¶“å†·çŸ¥è­˜',
                subtitle: 'ç¿»ç‰Œå•ç­”',
                icon: 'lightbulb',
                type: 'trivia',
                url: 'https://raw.githubusercontent.com/annelin0321/witty-bible-data/main/bible-trivia.json',
                desc: 'åŸä¾†è–ç¶“é‚„æœ‰é€™äº›å°çŸ¥è­˜ï¼Ÿç¿»ç‰Œè¦‹çœŸç« ï¼'
            }
        ];

        let currentQuizData = [];
        let currentQuizConfig = null;
        let currentQuestionIndex = 0;
        let quizScore = 0;
        let quizTimer = null;
        let quizTimeLeft = 0;
        let userExamAnswers = [];

        function renderSchoolMenu() {
            const container = document.getElementById('menu-grid');
            let html = '';
            QUIZ_CONFIG.forEach(item => {
                html += `
                    <div onclick="initQuiz('${item.id}')" class="clean-card cursor-pointer group hover:bg-white/80">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="p-3 rounded-full bg-[#F1F3F2] group-hover:bg-[#6B8E23] group-hover:text-white transition-colors text-[#6B8E23]">
                                <i data-lucide="${item.icon}" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-[#3E3B39] text-lg">${item.title}</h3>
                                <p class="text-xs text-[#8D7B68] uppercase tracking-wider">${item.subtitle}</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500">${item.desc}</p>
                    </div>
                `;
            });
            container.innerHTML = html;
            if(window.lucide) lucide.createIcons();
        }

        async function initQuiz(id) {
            const config = QUIZ_CONFIG.find(c => c.id === id);
            currentQuizConfig = config;
            document.getElementById('school-menu').classList.add('hidden');
            const area = document.getElementById('school-quiz-area');
            area.classList.remove('hidden');
            area.innerHTML = '<p class="text-center py-10 text-[#8D7B68]">æ­£åœ¨æº–å‚™è©¦å·...</p>';

            try {
                const res = await fetch(config.url);
                const data = await res.json();
                // éš¨æ©Ÿæ’åˆ—é¡Œç›®ï¼Œè‹¥å¤§æ–¼20é¡Œå‰‡å–20é¡Œ (é¿å…ç·´ç¿’å¤ªé•·)
                currentQuizData = data.sort(() => 0.5 - Math.random());
                if (currentQuizData.length > 20) currentQuizData = currentQuizData.slice(0, 20);
                
                currentQuestionIndex = 0;
                userExamAnswers = [];

                if (config.type === 'exam') startExam();
                else if (config.type === 'practice') renderPracticeQuestion();
                else if (config.type === 'trivia') renderTriviaCard();
            } catch (e) {
                console.error(e);
                area.innerHTML = '<p class="text-center text-red-500">è¼‰å…¥å¤±æ•—</p><button class="nature-btn mx-auto block mt-4" onclick="exitQuiz()">è¿”å›</button>';
            }
        }

        function exitQuiz() {
            clearInterval(quizTimer);
            document.getElementById('school-quiz-area').classList.add('hidden');
            document.getElementById('school-menu').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- Exam Mode (è¨ˆæ™‚ã€æ‰¹æ¬¡å°ç­”æ¡ˆ) ---
        function startExam() {
            quizTimeLeft = 180; // 3åˆ†é˜
            renderExamUI();
            quizTimer = setInterval(() => {
                quizTimeLeft--;
                if(document.getElementById('timer-display')) document.getElementById('timer-display').innerText = quizTimeLeft;
                if(quizTimeLeft <= 0) finishExam();
            }, 1000);
        }

        function renderExamUI() {
            const q = currentQuizData[currentQuestionIndex];
            const html = `
                <div class="max-w-2xl mx-auto">
                    <div class="flex justify-between items-center mb-6 bg-white/50 p-4 rounded-xl border border-white">
                        <span class="font-bold text-[#3E3B39]">ç¬¬ ${currentQuestionIndex + 1}/${currentQuizData.length} é¡Œ</span>
                        <span class="font-mono text-xl font-bold text-[#6B8E23]"><span id="timer-display">${quizTimeLeft}</span>s</span>
                    </div>
                    <div class="stationery-card animate-fadeIn">
                        <h3 class="text-xl font-bold text-[#3E3B39] mb-6 leading-relaxed">${q['é¡Œç›®']}</h3>
                        <div class="space-y-3">
                            ${['A','B','C','D'].map(opt => q['é¸é …'+opt] ? `
                                <button onclick="handleExamAnswer('${opt}')" class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 bg-white/60 hover:bg-[#6B8E23] hover:text-white transition-all flex items-center gap-3 group">
                                    <span class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center bg-white text-gray-500 group-hover:text-[#6B8E23] font-bold">${opt}</span>
                                    <span class="flex-1 font-medium">${q['é¸é …'+opt]}</span>
                                </button>
                            ` : '').join('')}
                        </div>
                    </div>
                    <div class="text-center mt-8">
                        <button onclick="finishExam()" class="text-sm text-gray-400 hover:text-red-500">ææ—©äº¤å·</button>
                    </div>
                </div>`;
            document.getElementById('school-quiz-area').innerHTML = html;
        }

        function handleExamAnswer(ans) {
            userExamAnswers[currentQuestionIndex] = ans;
            if(currentQuestionIndex < currentQuizData.length - 1) {
                currentQuestionIndex++;
                renderExamUI();
            } else {
                finishExam();
            }
        }

        function finishExam() {
            clearInterval(quizTimer);
            let correctCount = 0;
            let resultListHtml = '';

            currentQuizData.forEach((q, idx) => {
                const userAns = userExamAnswers[idx];
                const correctAnsFull = q['æ­£ç¢ºç­”æ¡ˆ'];
                const correctAnsLetter = correctAnsFull ? correctAnsFull.charAt(0).toUpperCase() : '';
                const isCorrect = userAns === correctAnsLetter;
                if(isCorrect) correctCount++;

                if (userAns) {
                    const statusIcon = isCorrect ? '<i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>' : '<i data-lucide="x-circle" class="w-5 h-5 text-red-500"></i>';
                    resultListHtml += `
                        <div class="bg-white/60 p-4 rounded-lg border ${isCorrect ? 'border-green-200' : 'border-red-200'} mb-3 text-left">
                            <div class="flex gap-3 mb-2">
                                <div class="mt-1">${statusIcon}</div>
                                <div>
                                    <p class="font-bold text-[#3E3B39] text-sm mb-1">ç¬¬ ${idx+1} é¡Œï¼š${q['é¡Œç›®']}</p>
                                    <div class="text-xs text-gray-500">
                                        ä½ çš„ç­”æ¡ˆï¼š<span class="${isCorrect?'text-green-600':'text-red-500'} font-bold">${userAns}</span> | 
                                        æ­£ç¢ºç­”æ¡ˆï¼š<span class="text-green-600 font-bold">${correctAnsFull}</span>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                }
            });

            const score = Math.round((correctCount / currentQuizData.length) * 100);
            document.getElementById('school-quiz-area').innerHTML = `
                <div class="max-w-2xl mx-auto text-center">
                    <div class="mb-8">
                        <div class="inline-block p-4 rounded-full bg-white shadow-lg mb-4">
                            <span class="text-4xl font-bold ${score >= 60 ? 'text-[#6B8E23]' : 'text-[#D85C42]'}">${score}åˆ†</span>
                        </div>
                        <h2 class="text-2xl font-bold text-[#3E3B39]">æ¸¬é©—çµæŸ</h2>
                        <p class="text-gray-500">ç­”å° ${correctCount} / ${currentQuizData.length} é¡Œ</p>
                    </div>
                    <div class="mb-8 max-h-[400px] overflow-y-auto pr-2">
                        ${resultListHtml || '<div class="text-gray-400 py-4">æœªä½œç­”ä»»ä½•é¡Œç›®</div>'}
                    </div>
                    <div class="flex justify-center gap-4">
                        <button onclick="exitQuiz()" class="nature-btn bg-white">è¿”å›é¸å–®</button>
                        <button onclick="initQuiz('${currentQuizConfig.id}')" class="nature-btn">å†æ¸¬ä¸€æ¬¡</button>
                    </div>
                </div>`;
            if(window.lucide) lucide.createIcons();
        }

        // --- Practice Mode (å³æ™‚å›é¥‹) ---
        function renderPracticeQuestion() {
            const q = currentQuizData[currentQuestionIndex];
            const html = `
                <div class="max-w-2xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <button onclick="exitQuiz()" class="text-sm text-[#8D7B68] hover:text-[#3E3B39] flex items-center gap-1">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> é€€å‡º
                        </button>
                        <span class="font-bold text-[#6B8E23]">Practice Mode</span>
                        <span class="text-sm text-gray-500">${currentQuestionIndex + 1} / ${currentQuizData.length}</span>
                    </div>

                    <div class="stationery-card relative overflow-hidden min-h-[400px] flex flex-col justify-center">
                        <h3 class="text-xl font-bold text-[#3E3B39] mb-8 leading-relaxed text-center">${q['é¡Œç›®']}</h3>
                        <div id="practice-options" class="space-y-3">
                            ${['A','B','C','D'].map(opt => q['é¸é …'+opt] ? `
                                <button id="opt-${opt}" onclick="handlePracticeAnswer('${opt}')" class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 bg-white/60 hover:bg-white transition-all flex items-center gap-3 group">
                                    <span class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center text-sm text-gray-500 font-bold bg-white">${opt}</span>
                                    <span class="flex-1 text-[#3E3B39] font-medium">${q['é¸é …'+opt]}</span>
                                </button>
                            ` : '').join('')}
                        </div>
                        
                        <div id="practice-feedback" class="hidden mt-6 pt-6 border-t border-gray-200 animate-fadeIn">
                            <div id="feedback-content" class="mb-4"></div>
                            <button onclick="nextPracticeQuestion()" class="nature-btn w-full justify-center">ä¸‹ä¸€é¡Œ <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i></button>
                        </div>
                    </div>
                </div>`;
            document.getElementById('school-quiz-area').innerHTML = html;
            if(window.lucide) lucide.createIcons();
        }

        function handlePracticeAnswer(selectedOption) {
            // Disable buttons
            document.querySelectorAll('#practice-options button').forEach(btn => btn.disabled = true);

            const q = currentQuizData[currentQuestionIndex];
            const correctAnsFull = q['æ­£ç¢ºç­”æ¡ˆ'];
            const correctAnsLetter = correctAnsFull ? correctAnsFull.charAt(0).toUpperCase() : '';
            const isCorrect = selectedOption === correctAnsLetter;

            // Styles
            const selectedBtn = document.getElementById(`opt-${selectedOption}`);
            if(selectedBtn) {
                selectedBtn.classList.remove('bg-white/60', 'hover:bg-white');
                selectedBtn.classList.add(isCorrect ? 'correct' : 'wrong');
            }
            if(!isCorrect) {
                const correctBtn = document.getElementById(`opt-${correctAnsLetter}`);
                if(correctBtn) {
                    correctBtn.classList.remove('bg-white/60', 'hover:bg-white');
                    correctBtn.classList.add('correct');
                }
            }

            // Feedback
            const feedbackEl = document.getElementById('practice-feedback');
            feedbackEl.classList.remove('hidden');
            document.getElementById('feedback-content').innerHTML = `
                <div class="flex items-start gap-3 ${isCorrect ? 'text-green-700' : 'text-red-600'}">
                    <i data-lucide="${isCorrect ? 'check-circle' : 'alert-circle'}" class="w-6 h-6 flex-shrink-0 mt-0.5"></i>
                    <div>
                        <p class="font-bold text-lg mb-1">${isCorrect ? 'ç­”å°äº†ï¼' : 'ç­”éŒ¯äº†'}</p>
                        <p class="text-sm text-gray-600"><span class="font-bold">æ­£ç¢ºç­”æ¡ˆï¼š</span>${correctAnsFull}</p>
                        ${q['å‚™è¨»'] ? `<p class="text-sm text-[#8D7B68] mt-2 bg-[#F1F3F2] p-2 rounded"><span class="font-bold">ğŸ’¡ å‚™è¨»ï¼š</span>${q['å‚™è¨»']}</p>` : ''}
                    </div>
                </div>`;
            if(window.lucide) lucide.createIcons();
        }

        function nextPracticeQuestion() {
            if (currentQuestionIndex < currentQuizData.length - 1) {
                currentQuestionIndex++;
                renderPracticeQuestion();
            } else {
                document.getElementById('school-quiz-area').innerHTML = `
                    <div class="text-center py-20 animate-fadeIn">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600">
                            <i data-lucide="trophy" class="w-10 h-10"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-[#3E3B39] mb-2">ç·´ç¿’å®Œæˆï¼</h2>
                        <p class="text-gray-500 mb-8">ä½ å·²ç¶“å®Œæˆäº†æœ¬å–®å…ƒçš„æ‰€æœ‰é¡Œç›®ã€‚</p>
                        <button onclick="exitQuiz()" class="nature-btn">è¿”å›é¸å–®</button>
                    </div>`;
                if(window.lucide) lucide.createIcons();
            }
        }

        // --- Trivia Mode ---
        function renderTriviaCard() {
            const q = currentQuizData[currentQuestionIndex];
            const html = `
                <div class="max-w-md mx-auto h-full flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <button onclick="exitQuiz()" class="text-sm text-[#8D7B68] hover:text-[#3E3B39]">é€€å‡º</button>
                        <span>${currentQuestionIndex + 1} / ${currentQuizData.length}</span>
                    </div>
                    <div class="flip-card mb-8" onclick="this.classList.toggle('flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <span class="absolute top-4 left-4 text-xs text-gray-400 tracking-widest">QUESTION</span>
                                <h3 class="text-xl font-bold mb-6 leading-relaxed">${q['é¡Œç›®']}</h3>
                                <div class="w-full text-left space-y-2 text-sm text-gray-600 opacity-80">
                                    ${['A','B','C','D'].map(opt => q['é¸é …'+opt] ? `<div class="p-2 border rounded">${opt}. ${q['é¸é …'+opt]}</div>` : '').join('')}
                                </div>
                                <p class="absolute bottom-4 text-xs text-[#6B8E23] animate-bounce">é»æ“Šç¿»çœ‹ç­”æ¡ˆ</p>
                            </div>
                            <div class="flip-card-back">
                                <span class="absolute top-4 left-4 text-xs text-white/60 tracking-widest">ANSWER</span>
                                <div class="text-center">
                                    <h3 class="text-2xl font-bold mb-4">${q['æ­£ç¢ºç­”æ¡ˆ']}</h3>
                                    ${q['å‚™è¨»'] ? `<div class="w-8 h-1 bg-white/50 mx-auto my-4 rounded"></div><p class="text-white/90 text-sm leading-relaxed">${q['å‚™è¨»']}</p>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-between gap-4">
                         <button onclick="prevTrivia()" class="nature-btn flex-1" ${currentQuestionIndex===0?'disabled style="opacity:0.5"':''}>ä¸Šä¸€å¼µ</button>
                         <button onclick="nextTrivia()" class="nature-btn flex-1" ${currentQuestionIndex===currentQuizData.length-1?'disabled style="opacity:0.5"':''}>ä¸‹ä¸€å¼µ</button>
                    </div>
                </div>`;
            document.getElementById('school-quiz-area').innerHTML = html;
        }

        function nextTrivia() {
            if(currentQuestionIndex < currentQuizData.length - 1) { currentQuestionIndex++; renderTriviaCard(); }
        }
        function prevTrivia() {
            if(currentQuestionIndex > 0) { currentQuestionIndex--; renderTriviaCard(); }
        }

        renderSchoolMenu();
    </script>
</body>
</html>
